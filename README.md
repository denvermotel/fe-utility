 <header>
    <h1>ğŸ“„ Plugin Fatture Elettroniche e Corrispettivi &mdash; v0.92 beta</h1>
    <p>Bookmarklet per il portale ivaservizi.agenziaentrate.gov.it</p>
  </header>

  <div class="card">
    <h2>âš™ Installazione</h2>
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-text">Mostra la <b>barra dei preferiti</b> &mdash; Chrome/Edge/Firefox: <span class="kbd">Ctrl+Shift+B</span></div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-text">
        <b>Trascina</b> il pulsante nella barra dei preferiti:<br><br>
        <a class="bookmarklet-link" href="javascript:(function()%7B'use%20strict'%3Bif(window._FEPlugin)%7Bvar%20ex%3Ddocument.getElementById('FEPlugin_Panel')%3Bif(ex)%7Bex.style.display%3Dex.style.display%3D%3D%3D'none'%3F'block'%3A'none'%3B%7Dreturn%3B%7Dwindow._FEPlugin%3Dtrue%3Bvar%20FmtNum%3Dnew%20Intl.NumberFormat('it-IT'%2C%7Bstyle%3A'decimal'%2CminimumFractionDigits%3A2%2CmaximumFractionDigits%3A2%7D)%3Bfunction%20convN(s)%7Bif(!s)return%200%3Breturn%20Number(parseFloat(String(s).replace(%2F%5C.%2Fg%2C'').replace('%2C'%2C'.')))%7C%7C0%3B%7Dfunction%20fmtN(n)%7Breturn%20FmtNum.format(n)%3B%7Dfunction%20somma(arr)%7Breturn%20arr.reduce(function(a%2Cb)%7Breturn%20a%2Bb%3B%7D%2C0)%3B%7Dfunction%20ae(str%2Cn)%7Breturn%20str%2B(n%3D%3D1%3F'a'%3A'e')%3B%7Dfunction%20ei(str%2Cn)%7Breturn%20str%2B(n%3D%3D1%3F'e'%3A'i')%3B%7Dfunction%20pad2(n)%7Breturn%20String(n).padStart(2%2C'0')%3B%7Dvar%20STORAGE_PREFIX%3D'FEPlugin_'%3Bfunction%20storageGet(key%2Cdef)%7Btry%7Bvar%20v%3DlocalStorage.getItem(STORAGE_PREFIX%2Bkey)%3Breturn%20v!%3D%3Dnull%3FJSON.parse(v)%3Adef%3B%7Dcatch(e)%7Breturn%20def%3B%7D%7Dfunction%20storageSet(key%2Cval)%7Btry%7BlocalStorage.setItem(STORAGE_PREFIX%2Bkey%2CJSON.stringify(val))%3B%7Dcatch(e)%7B%7D%7Dfunction%20getAngular()%7Breturn%20window.angular%3B%7Dfunction%20getVmScope()%7Bif(!getAngular())return%20null%3Bvar%20nav%3Ddocument.querySelector('nav%5Baria-label*%3D%22aginaz%22%5D')%3Bif(nav)%7Bvar%20s%3Dangular.element(nav).scope()%3Bwhile(s)%7Bif(s.vm%26%26s.vm.pager)return%20s%3Bs%3Ds.%24parent%3B%7D%7Dvar%20row%3Ddocument.querySelector('%5Bdata-ng-repeat*%3D%22vm.items%22%5D')%3Bif(row)%7Bvar%20s2%3Dangular.element(row).scope()%3Bwhile(s2)%7Bif(s2.vm%26%26s2.vm.pager)return%20s2%3Bs2%3Ds2.%24parent%3B%7D%7Dreturn%20null%3B%7Dfunction%20getTotalPages()%7Bvar%20scope%3DgetVmScope()%3Bif(scope%26%26scope.vm.pager)return%20scope.vm.pager.totalPages%7C%7C1%3Bvar%20liPages%3Ddocument.querySelectorAll('nav%5Baria-label*%3D%22aginaz%22%5Dli%5Bdata-ng-repeat%5D')%3Breturn%20liPages.length%7C%7C1%3B%7Dfunction%20setPage(n)%7Breturn%20new%20Promise(function(resolve)%7Bvar%20scope%3DgetVmScope()%3Bif(scope%26%26scope.vm.setPage)%7Bscope.%24apply(function()%7Bscope.vm.setPage(n)%3B%7D)%3BsetTimeout(resolve%2C700)%3Breturn%3B%7Dvar%20links%3Ddocument.querySelectorAll('nav%5Baria-label*%3D%22aginaz%22%5Da%5Bdata-ng-click*%3D%22setPage%22%5D')%3Bfor(var%20i%3D0%3Bi%3Clinks.length%3Bi%2B%2B)%7Bif(links%5Bi%5D.textContent.trim()%3D%3D%3DString(n))%7Blinks%5Bi%5D.click()%3BsetTimeout(resolve%2C700)%3Breturn%3B%7D%7Dresolve()%3B%7D)%3B%7Dfunction%20trySetAllOnOnePage()%7Btry%7Bvar%20scope%3DgetVmScope()%3Bif(!scope%7C%7C!scope.vm.pager)return%20false%3Bvar%20pager%3Dscope.vm.pager%3Bif(pager.totalPages%3C%3D1)return%20true%3Bvar%20oldSize%3Dpager.pageSize%3Bscope.%24apply(function()%7Bpager.pageSize%3D9999%3Bif(scope.vm.setPage)scope.vm.setPage(1)%3B%7D)%3BsetTimeout(function()%7Bvar%20newPages%3DgetTotalPages()%3Blog('PageSize%20hack%3Apagine%20ora%3D'%2BnewPages)%3B%7D%2C1000)%3Breturn%20(getTotalPages()%3C%3D1)%3B%7Dcatch(e)%7Breturn%20false%3B%7D%7Dfunction%20%24(sel%2Cctx)%7Breturn%20(ctx%7C%7Cdocument).querySelector(sel)%3B%7Dfunction%20%24%24(sel%2Cctx)%7Breturn%20Array.from((ctx%7C%7Cdocument).querySelectorAll(sel))%3B%7Dfunction%20creaEl(tag%2Cid%2Cparent%2Chtml%2Cprima)%7Bvar%20el%3Ddocument.createElement(tag)%3Bel.id%3Did%3Bel.name%3Did%3Bvar%20p%3Dtypeof%20parent%3D%3D%3D'string'%3Fdocument.getElementById(parent)%3Aparent%3Bif(prima%26%26p)p.parentNode.insertBefore(el%2Cp)%3Belse%20if(p)p.appendChild(el)%3Bif(html!%3Dnull)el.innerHTML%3Dhtml%3Breturn%20el%3B%7Dfunction%20rimuoviEl(id)%7Bvar%20el%3Ddocument.getElementById(id)%3Bif(el)el.parentNode.removeChild(el)%3B%7Dfunction%20ricercaNeiTag(tag%2Cstr)%7Breturn%20Array.from(document.getElementsByTagName(tag)).some(function(el)%7Breturn%20el.innerText.indexOf(str)%3E-1%3B%7D)%3B%7Dvar%20panelId%3D'FEPlugin_Panel'%3Bfunction%20creaPanel()%7Bif(document.getElementById(panelId))return%3Bvar%20stile%3Ddocument.createElement('style')%3Bstile.textContent%3D'%23FEPlugin_Panel%7B'%2B'all%3Ainitial!important%3Bdisplay%3Ablock!important%3B'%2B'position%3Afixed!important%3Btop%3A0!important%3Bleft%3A0!important%3B'%2B'width%3A100vw!important%3Bbox-sizing%3Aborder-box!important%3B'%2B'z-index%3A2147483647!important%3B'%2B'background%3A%231b3a2b!important%3B'%2B'border-bottom%3A2px%20solid%20%232e7d32!important%3B'%2B'box-shadow%3A0%203px%2012px%20rgba(0%2C0%2C0%2C.6)!important%3B'%2B'font-family%3AArial%2CHelvetica%2Csans-serif!important%3B'%2B'font-size%3A12px!important%3Bcolor%3A%23e8f5e9!important%3B%7D'%2B'%23FEPlugin_TopRow%7B'%2B'all%3Ainitial!important%3B'%2B'display%3Aflex!important%3Bflex-direction%3Arow!important%3Bflex-wrap%3Anowrap!important%3B'%2B'align-items%3Acenter!important%3Bgap%3A5px!important%3B'%2B'padding%3A5px%2010px!important%3Bwidth%3A100%25!important%3Bbox-sizing%3Aborder-box!important%3B'%2B'overflow-x%3Aauto!important%3B%7D'%2B'%23FEPlugin_Logo%7B'%2B'all%3Ainitial!important%3B'%2B'font-family%3AArial%2Csans-serif!important%3Bfont-size%3A13px!important%3B'%2B'font-weight%3Abold!important%3Bcolor%3A%23a5d6a7!important%3B'%2B'white-space%3Anowrap!important%3Bflex-shrink%3A0!important%3Bmargin-right%3A4px!important%3B%7D'%2B'%23FEPlugin_BottomRow%7B'%2B'all%3Ainitial!important%3Bdisplay%3Anone!important%3Bwidth%3A100%25!important%3B'%2B'box-sizing%3Aborder-box!important%3Bpadding%3A2px%2010px%205px!important%3B%7D'%2B'%23FEPlugin_PBar%7B'%2B'all%3Ainitial!important%3Bdisplay%3Ainline-block!important%3B'%2B'width%3A180px!important%3Bheight%3A8px!important%3B'%2B'background%3A%23263238!important%3Bborder-radius%3A4px!important%3Boverflow%3Ahidden!important%3B'%2B'vertical-align%3Amiddle!important%3Bmargin-right%3A8px!important%3B%7D'%2B'%23FEPlugin_PFill%7B'%2B'all%3Ainitial!important%3Bdisplay%3Ablock!important%3B'%2B'height%3A100%25!important%3Bbackground%3A%2343a047!important%3Bwidth%3A0%25!important%3B'%2B'transition%3Awidth%20.4s!important%3B%7D'%2B'%23FEPlugin_Status%7B'%2B'all%3Ainitial!important%3Bdisplay%3Ainline!important%3B'%2B'font-family%3AArial%2Csans-serif!important%3Bfont-size%3A11px!important%3B'%2B'color%3A%2380cbc4!important%3Bvertical-align%3Amiddle!important%3B%7D'%2B'.fepBtn%7B'%2B'all%3Ainitial!important%3Bdisplay%3Ainline-block!important%3B'%2B'padding%3A5px%2010px!important%3Bborder%3Anone!important%3Bborder-radius%3A4px!important%3B'%2B'cursor%3Apointer!important%3Bfont-size%3A11px!important%3Bfont-weight%3Abold!important%3B'%2B'white-space%3Anowrap!important%3Bflex-shrink%3A0!important%3B'%2B'font-family%3AArial%2Csans-serif!important%3Bline-height%3A1.4!important%3B'%2B'transition%3Afilter%20.15s!important%3B%7D'%2B'.fepBtn%3Ahover%7Bfilter%3Abrightness(1.2)!important%3B%7D'%2B'.fepBtn%3Adisabled%7Bopacity%3A.4!important%3Bcursor%3Anot-allowed!important%3B%7D'%2B'.fep-green%7Bbackground%3A%232e7d32!important%3Bcolor%3A%23fff!important%3B%7D'%2B'.fep-blue%7Bbackground%3A%231565c0!important%3Bcolor%3A%23fff!important%3B%7D'%2B'.fep-orange%7Bbackground%3A%23e65100!important%3Bcolor%3A%23fff!important%3B%7D'%2B'.fep-teal%7Bbackground%3A%2300695c!important%3Bcolor%3A%23fff!important%3B%7D'%2B'.fep-red%7Bbackground%3A%23b71c1c!important%3Bcolor%3A%23fff!important%3B%7D'%2B'.fep-grey%7Bbackground%3A%2337474f!important%3Bcolor%3A%23fff!important%3B%7D'%3Bdocument.head.appendChild(stile)%3Bvar%20p%3Ddocument.createElement('div')%3Bp.id%3DpanelId%3Bp.innerHTML%3D'%3Cdiv%20id%3D%22FEPlugin_TopRow%22%3E'%2B'%3Cspan%20id%3D%22FEPlugin_Logo%22%3E%26%23128196%3BFE%20v0.92%26%23946%3B%3C%2Fspan%3E'%2B'%3Cbutton%20class%3D%22fepBtn%20fep-green%22%20id%3D%22btn_scaricaFE%22%3E%26%2311015%3BScarica%20fatture%3C%2Fbutton%3E'%2B'%3Cbutton%20class%3D%22fepBtn%20fep-blue%22%20id%3D%22btn_migliora%22%3E%26%23128202%3BMigliora%20tabella%3C%2Fbutton%3E'%2B'%3Cbutton%20class%3D%22fepBtn%20fep-teal%22%20id%3D%22btn_aggEstere%22%3E%26%23127760%3BTransfrontaliere%3C%2Fbutton%3E'%2B'%3Cbutton%20class%3D%22fepBtn%20fep-orange%22%20id%3D%22btn_corrispettivi%22%3E%26%23128200%3BCorrispettivi%26%238594%3BExcel%3C%2Fbutton%3E'%2B'%3Cbutton%20class%3D%22fepBtn%20fep-grey%22%20id%3D%22btn_datePicker%22%3E%26%23128197%3BDate%3C%2Fbutton%3E'%2B'%3Cbutton%20class%3D%22fepBtn%20fep-red%22%20id%3D%22btn_stop%22%20style%3D%22display%3Anone!important%22%3E%26%239209%3BStop%3C%2Fbutton%3E'%2B'%3Cbutton%20id%3D%22FEPlugin_X%22%20style%3D%22all%3Ainitial%3Bdisplay%3Ainline-block%3Bmargin-left%3Aauto%3B'%2B'padding%3A0%206px%3Bbackground%3Anone%3Bborder%3Anone%3Bcolor%3A%23a5d6a7%3Bfont-size%3A18px%3B'%2B'cursor%3Apointer%3Bline-height%3A1%3Bflex-shrink%3A0%3B%22%20title%3D%22Chiudi%22%3E%26%23x2715%3B%3C%2Fbutton%3E'%2B'%3C%2Fdiv%3E'%2B'%3Cdiv%20id%3D%22FEPlugin_BottomRow%22%20style%3D%22display%3Anone%22%3E'%2B'%3Cdiv%20id%3D%22FEPlugin_PBar%22%3E%3Cdiv%20id%3D%22FEPlugin_PFill%22%3E%3C%2Fdiv%3E%3C%2Fdiv%3E'%2B'%3Cspan%20id%3D%22FEPlugin_Status%22%3E%3C%2Fspan%3E'%2B'%3C%2Fdiv%3E'%3Bdocument.documentElement.appendChild(p)%3Bfunction%20aggiornaPadding()%7Bdocument.body.style.setProperty('padding-top'%2C(p.offsetHeight%7C%7C40)%2B'px'%2C'important')%3B%7DaggiornaPadding()%3Bvar%20_padTimer%3DsetInterval(aggiornaPadding%2C600)%3Bdocument.getElementById('FEPlugin_X').onclick%3Dfunction()%7Bp.remove()%3Bdocument.body.style.removeProperty('padding-top')%3BclearInterval(_padTimer)%3Bwindow._FEPlugin%3Dfalse%3B%7D%3Bdocument.getElementById('btn_scaricaFE').onclick%3DavviaDownloadFatture%3Bdocument.getElementById('btn_migliora').onclick%3DmiglioraTabella%3Bdocument.getElementById('btn_aggEstere').onclick%3DaggiungiFattureTransfrontaliere%3Bdocument.getElementById('btn_corrispettivi').onclick%3DavviaAnalisiCorrispettivi%3Bdocument.getElementById('btn_datePicker').onclick%3DcreaSelezionaDate%3Bdocument.getElementById('btn_stop').onclick%3Dfunction()%7B_stop%3Dtrue%3BsetStatus('%26%239209%3BInterruzione%20in%20corso%26%238230%3B')%3B%7D%3B%7Dfunction%20setProgress(pct%2Cmsg)%7Bvar%20fill%3Ddocument.getElementById('FEPlugin_PFill')%3Bvar%20row%3Ddocument.getElementById('FEPlugin_BottomRow')%3Bif(!fill)return%3Bif(row)row.style.setProperty('display'%2C'block'%2C'important')%3Bfill.style.setProperty('width'%2CMath.min(100%2Cpct)%2B'%25'%2C'important')%3Bif(msg!%3Dnull)setStatus(msg)%3B%7Dfunction%20setStatus(msg)%7Bvar%20el%3Ddocument.getElementById('FEPlugin_Status')%3Bif(el)el.textContent%3Dmsg%3B%7Dfunction%20log(msg)%7Bconsole.log('%5BFEPlugin%5D'%2Cmsg)%3B%7Dvar%20_stop%3Dfalse%3Bvar%20_inCorso%3Dfalse%3Bfunction%20setRunning(on)%7B_inCorso%3Don%3B_stop%3Dfalse%3Bvar%20stopBtn%3Ddocument.getElementById('btn_stop')%3Bif(stopBtn)stopBtn.style.display%3Don%3F'block'%3A'none'%3B%5B'btn_scaricaFE'%2C'btn_migliora'%2C'btn_aggEstere'%2C'btn_corrispettivi'%5D.forEach(function(id)%7Bvar%20el%3Ddocument.getElementById(id)%3Bif(el)el.disabled%3Don%3B%7D)%3B%7Dvar%20vFEScaricate%3DstorageGet('FEScaricate'%2C%7B%7D)%3Bfunction%20avviaDownloadFatture()%7Bvar%20hash%3Dwindow.location.hash%3Bif(hash.indexOf('%2Ffatture%2F')%3D%3D%3D-1%26%26hash.indexOf('%2Ftransfrontaliere%2F')%3D%3D%3D-1)%7Balert('Vai%20prima%20nella%20sezione%20%22Fatture%20emesse%22%20o%20%22Fatture%20acquisti%22.')%3Breturn%3B%7Dif(_inCorso)return%3BsetRunning(true)%3BsetProgress(0%2C'Raccolta%20link%20fatture(tutte%20le%20pagine)...')%3Bvar%20pagineSingola%3DtrySetAllOnOnePage()%3BsetTimeout(function()%7BraccogliLinkTuttiPagine(1%2CgetTotalPages()%2C%5B%5D%2Cfunction(links)%7Bif(_stop)%7BsetRunning(false)%3Breturn%3B%7DsetStatus('%E2%96%B6%20'%2Blinks.length%2B'%20fatture%20trovate.%20Avvio%20download...')%3BscaricaFattura(links%2C0)%3B%7D)%3B%7D%2CpagineSingola%3F800%3A100)%3B%7Dfunction%20raccogliLinkTuttiPagine(pagina%2CtotPagine%2Clinks%2Ccallback)%7Bif(_stop)%7Bcallback(links)%3Breturn%3B%7Dvar%20btns%3Ddocument.querySelectorAll('a.btn.btn-primary.btn-xs.ng-scope')%3Bbtns.forEach(function(b)%7Blinks.push(b.href%7C%7Cb.getAttribute('href')%7C%7Cb)%3B%7D)%3BsetProgress(pagina%2FtotPagine*20%2C'Raccolta%20pagina%20'%2Bpagina%2B'%2F'%2BtotPagine)%3Bif(pagina%3E%3DtotPagine)%7BsetPage(1).then(function()%7Bcallback(links)%3B%7D)%3B%7Delse%7BsetPage(pagina%2B1).then(function()%7BraccogliLinkTuttiPagine(pagina%2B1%2CtotPagine%2Clinks%2Ccallback)%3B%7D)%3B%7D%7Dfunction%20aspettaDettaglioFattura(resolve%2Cms)%7Bms%3Dms%7C%7C0%3Bif(ms%3E6000)%7Bresolve(false)%3Breturn%3B%7Dvar%20btns%3Ddocument.getElementsByClassName('btn%20btn-primary')%3Bfor(var%20i%3D0%3Bi%3Cbtns.length%3Bi%2B%2B)%7Bif(btns%5Bi%5D.innerText.indexOf('Download%20file%20fattura')%3E-1)%7Bresolve(true)%3Breturn%3B%7D%7DsetTimeout(function()%7BaspettaDettaglioFattura(resolve%2Cms%2B200)%3B%7D%2C200)%3B%7Dfunction%20scaricaFattura(links%2Cidx)%7Bif(_stop%7C%7Cidx%3E%3Dlinks.length)%7BstorageSet('FEScaricate'%2CvFEScaricate)%3BsetRunning(false)%3Bif(!_stop)setProgress(100%2C'%E2%9C%85%20Completato!'%2Bidx%2B'%20fatture%20elaborate.')%3Bvar%20prow%3Ddocument.getElementById('FEPlugin_BottomRow')%3Bif(prow)setTimeout(function()%7Bprow.style.setProperty('display'%2C'none'%2C'important')%3B%7D%2C3000)%3Breturn%3B%7Dvar%20pct%3D20%2B(idx%2Flinks.length*80)%3BsetProgress(pct%2C'Fattura%20'%2B(idx%2B1)%2B'%2F'%2Blinks.length)%3Bvar%20link%3Dlinks%5Bidx%5D%3Bif(typeof%20link%3D%3D%3D'string')%7Bwindow.location.hash%3Dlink.replace(%2F%5E%5B%5E%23%5D*%23%2F%2C'%23')%3B%7Delse%20if(link.click)%7Blink.click()%3B%7Dnew%20Promise(function(res)%7BaspettaDettaglioFattura(res)%3B%7D).then(function(caricato)%7Bif(!caricato)%7Blog('Timeout%20dettaglio%20fattura%20%23'%2Bidx%2B'%2Csalto.')%3BtornaAllaLista(function()%7BscaricaFattura(links%2Cidx%2B1)%3B%7D)%3Breturn%3B%7Dvar%20btns%3Ddocument.getElementsByClassName('btn%20btn-primary')%3Bvar%20IDSDI%3D''%2CstatoSdi%3D''%2CcodiceStato%3D1%3Btry%7Bvar%20pb%3Ddocument.querySelector('.panel-body')%3Bif(pb)%7Bvar%20primaP%3Dpb.children%5B0%5D%3Bvar%20strongs%3DprimaP%3FprimaP.querySelectorAll('strong.ng-binding')%3A%5B%5D%3BIDSDI%3Dstrongs%5B0%5D%3Fstrongs%5B0%5D.innerText.trim()%3A''%3BstatoSdi%3Dstrongs%5B1%5D%3Fstrongs%5B1%5D.innerText.trim()%3A''%3B%7Dvar%20rifiutata%3Ddocument.body.innerText.indexOf('rifiutata')%3E-1%3Bif(!rifiutata)%7Bfor(var%20i%3D0%3Bi%3Cbtns.length%3Bi%2B%2B)%7Bif(btns%5Bi%5D.innerText.indexOf('Download%20file%20fattura')%3E-1%26%26btns%5Bi%5D.innerText.indexOf('meta')%3D%3D%3D-1)%7Bbtns%5Bi%5D.click()%3Bbreak%3B%7D%7DsetTimeout(function()%7Bfor(var%20j%3D0%3Bj%3Cbtns.length%3Bj%2B%2B)%7Bif(btns%5Bj%5D.innerText.indexOf('meta')%3E-1)%7Bbtns%5Bj%5D.click()%3Bbreak%3B%7D%7D%7D%2C300)%3Bif(statoSdi.indexOf('accettata')%3E-1)codiceStato%3D3%3Belse%20if(statoSdi.indexOf('Decorrenza')%3E-1%7C%7CstatoSdi.indexOf('decorrenza')%3E-1)codiceStato%3D-3%3Belse%20if(statoSdi%3D%3D%3D'Non%20consegnata')codiceStato%3D-1%3Belse%20if(document.body.innerText.indexOf('in%20attesa')%3E-1)codiceStato%3D2%3B%7Delse%7BcodiceStato%3D-2%3B%7Dif(IDSDI)vFEScaricate%5BIDSDI%5D%3D%7BStato%3AcodiceStato%2CDataScaricamento%3ADate.now()%7D%3B%7Dcatch(e)%7Blog('Errore%20lettura%20dati%20fattura%3A'%2Be)%3B%7DsetTimeout(function()%7BtornaAllaLista(function()%7BscaricaFattura(links%2Cidx%2B1)%3B%7D)%3B%7D%2C500)%3B%7D)%3B%7Dfunction%20tornaAllaLista(callback)%7Bvar%20chevron%3Ddocument.querySelector('.fa-chevron-left')%3Bif(chevron%26%26chevron.parentNode)%7Bchevron.parentNode.click()%3BsetTimeout(callback%2C600)%3Breturn%3B%7Dvar%20scope%3DgetVmScope()%3Bif(scope%26%26scope.vm.backtoLista)%7Bscope.%24apply(function()%7Bscope.vm.backtoLista()%3B%7D)%3BsetTimeout(callback%2C600)%3B%7Delse%7Bhistory.back()%3BsetTimeout(callback%2C700)%3B%7D%7Dvar%20ColoreSegno%3D%7Btrue%3A'black'%2Cfalse%3A'red'%7D%3Bvar%20TR_TOT_ID%3D'FEPlugin_RigaTotali'%3Bvar%20vStringheFE%3D%7B'-3'%3A'%3Ci%3EDecorrenza%3Cbr%3Etermini%3C%2Fi%3E'%2C'-2'%3A'%3Cb%20style%3D%22color%3Ared%22%3ERifiutata%3C%2Fb%3E'%2C'-1'%3A'%3Cspan%20style%3D%22font-size%3A9px%22%3ENon%20consegnata%3C%2Fspan%3E'%2C'1'%3A'Consegnata'%2C'2'%3A'%3Cdiv%20style%3D%22font-size%3A10px%3Bfont-weight%3Abold%22%3ECons.%20in%20attesa%3Cbr%3Eesito%3C%2Fdiv%3E'%2C'3'%3A'%3Cb%20style%3D%22color%3Agreen%22%3EAccettata%3C%2Fb%3E'%7D%3Bvar%20vColoriFE%3D%7B'-3'%3A'grey'%2C'-2'%3A'brown'%2C'-1'%3A'darkcyan'%2C'1'%3A'darkturquoise'%2C'2'%3A'orange'%2C'3'%3A'green'%7D%3Bfunction%20miglioraTabella()%7Bvar%20hash%3Dwindow.location.hash%3Bvar%20suFatture%3Dhash.indexOf('%2Ffatture%2F')%3E-1%7C%7Chash.indexOf('%2Ftransfrontaliere%2F')%3E-1%3Bif(!suFatture)%7Balert('Vai%20prima%20nella%20sezione%20%22Fatture%20emesse%22%20o%20%22Fatture%20acquisti%22.')%3Breturn%3B%7DsetStatus('Elaborazione%20tabella...')%3Bvar%20tabella%3Ddocument.querySelector('table.table-responsive%2C.table-responsive%20table%2Ctable')%3Bif(!tabella)%7BsetStatus('%E2%9A%A0%20Tabella%20non%20trovata.')%3Breturn%3B%7Dvar%20tbody%3Dtabella.querySelector('tbody')%3Bvar%20thead%3Dtabella.querySelector('thead%20tr')%3Bif(!tbody%7C%7C!thead)%7BsetStatus('%E2%9A%A0%20Struttura%20tabella%20non%20riconosciuta.')%3Breturn%3B%7Dvar%20righe%3Dtbody.querySelectorAll('tr')%3Bif(righe.length%3D%3D%3D0)%7BsetStatus('%E2%9A%A0%20Nessuna%20riga%20nella%20tabella.')%3Breturn%3B%7Dvar%20FattureEmesse%3DricercaNeiTag('h1'%2C'emesse')%7C%7CricercaNeiTag('h2'%2C'emesse')%3Bvar%20imponibili%3D%5B%5D%2Cive%3D%5B%5D%3Bthead.style.fontSize%3D'10px'%3Bif(!document.getElementById('FEPlugin_ThTotale'))%7Bvar%20thTot%3Ddocument.createElement('th')%3BthTot.id%3D'FEPlugin_ThTotale'%3BthTot.textContent%3D'Totale'%3BthTot.style.textAlign%3D'center'%3Bvar%20thLast%3Dthead.lastElementChild%3Bthead.insertBefore(thTot%2CthLast)%3B%7Dvar%20TipoDocCol%3D1%2CNumCol%3D2%2CDataCol%3D3%2CCFNomeCol%3D4%2CImpCol%3D5%2CIvaCol%3D6%2CSDICol%3D7%3BArray.from(righe).forEach(function(riga%2Ci)%7Briga.style.cursor%3D'pointer'%3Briga.dataset.fe_on%3D'si'%3Briga.title%3D'Clicca%20per%20escludere%20dal%20totale'%3Briga.style.opacity%3D'1'%3Briga.onclick%3Dfunction(e)%7BtoggleRiga(e.currentTarget)%3B%7D%3Bvar%20cfCell%3Driga.children%5BCFNomeCol%5D%3Bif(cfCell)%7Bvar%20srSpan%3DcfCell.querySelector('.sr-only')%3Bif(srSpan)%7Bvar%20parts%3DsrSpan.innerText.split('-')%3Bif(parts.length%3E%3D2)%7BcfCell.innerHTML%3D'%3Cspan%20style%3D%22font-size%3A10px%22%3E%3Cb%3E'%2B(parts%5B1%5D%7C%7C'')%2B'%3C%2Fb%3E%3Cbr%3E'%2B(parts%5B0%5D%7C%7C'')%2B'%3C%2Fspan%3E'%3B%7D%7D%7Dvar%20tipoDoc%3Driga.children%5BTipoDocCol%5D%3Friga.children%5BTipoDocCol%5D.innerText%3A''%3Bvar%20isNC%3DtipoDoc.indexOf('Nota%20di%20credito')%3E-1%3Bvar%20semplificata%3DtipoDoc.indexOf('semplificata')%3E-1%3Bvar%20impCell%3Driga.children%5BImpCol%5D%3Bvar%20ivaCell%3Driga.children%5BIvaCol%5D%3Bif(!impCell%7C%7C!ivaCell)return%3Bvar%20imp%3DconvN(impCell.innerText)%3Bvar%20iva%3DconvN(ivaCell.innerText)%3Bif(semplificata)imp-%3Diva%3Bif(isNC%26%26(imp%2Biva)%3E0)%7Bimp%3D-imp%3Biva%3D-iva%3B%7DimpCell.innerText%3DfmtN(imp)%3BivaCell.innerText%3DfmtN(iva)%3BimpCell.style.color%3DColoreSegno%5Bimp%3E%3D0%5D%3BivaCell.style.color%3DColoreSegno%5Biva%3E%3D0%5D%3Bimponibili%5Bi%5D%3Dimp%3Bive%5Bi%5D%3Diva%3Bvar%20tot%3Dimp%2Biva%3Bvar%20tdTot%3Ddocument.getElementById('FEPlugin_Totale_'%2Bi)%3Bif(!tdTot)%7BtdTot%3Ddocument.createElement('td')%3BtdTot.id%3D'FEPlugin_Totale_'%2Bi%3Bvar%20ultimaTd%3Driga.lastElementChild%3Briga.insertBefore(tdTot%2CultimaTd)%3B%7DtdTot.innerText%3DfmtN(tot)%3BtdTot.style.textAlign%3D'right'%3BtdTot.style.fontWeight%3D'bold'%3BtdTot.style.color%3DColoreSegno%5Btot%3E%3D0%5D%3Bvar%20sdiCell%3Driga.children%5BSDICol%5D%3Bvar%20IDSDI%3DsdiCell%3FsdiCell.innerText.trim()%3A''%3Bif(IDSDI%26%26vFEScaricate%5BIDSDI%5D)%7Bvar%20stato%3DString(vFEScaricate%5BIDSDI%5D.Stato)%3Bvar%20btnInfo%3Driga.querySelector('.btn-xs')%3Bif(btnInfo)%7BbtnInfo.innerHTML%3DvStringheFE%5Bstato%5D%7C%7Cstato%3BbtnInfo.style.backgroundColor%3DvColoriFE%5Bstato%5D%7C%7C''%3B%7D%7D%7D)%3BaggiornaTotali(tbody%2Cimponibili%2Cive)%3Bif(FattureEmesse)analizzaNumeriMancanti(righe)%3BsetStatus('%E2%9C%85%20Tabella%20migliorata.%20'%2Brighe.length%2B'%20righe%20elaborate.')%3B%7Dfunction%20toggleRiga(riga)%7Bvar%20on%3Driga.dataset.fe_on%3D%3D%3D'si'%3Briga.dataset.fe_on%3Don%3F'no'%3A'si'%3Briga.style.opacity%3Don%3F'0.35'%3A'1'%3Briga.title%3Don%3F'Fattura%20esclusa-clicca%20per%20reincludere'%3A'Clicca%20per%20escludere%20dal%20totale'%3BricalcolaTotali()%3B%7Dfunction%20ricalcolaTotali()%7Bvar%20tbody%3Ddocument.querySelector('table%20tbody')%3Bif(!tbody)return%3Bvar%20imponibili%3D%5B%5D%2Cive%3D%5B%5D%3BArray.from(tbody.querySelectorAll('tr%5Bdata-fe_on%5D')).forEach(function(r%2Ci)%7Bif(r.dataset.fe_on!%3D%3D'si')%7Bimponibili.push(0)%3Bive.push(0)%3Breturn%3B%7Dvar%20cells%3Dr.children%3Bimponibili.push(convN(cells%5B5%5D%3Fcells%5B5%5D.innerText%3A'0'))%3Bive.push(convN(cells%5B6%5D%3Fcells%5B6%5D.innerText%3A'0'))%3B%7D)%3BaggiornaTotali(tbody%2Cimponibili%2Cive)%3B%7Dfunction%20aggiornaTotali(tbody%2Cimponibili%2Cive)%7Bvar%20totImp%3Dsomma(imponibili)%2CtotIva%3Dsomma(ive)%2CtotTot%3DtotImp%2BtotIva%3Bvar%20trTot%3Ddocument.getElementById(TR_TOT_ID)%3Bif(!trTot)%7BtrTot%3Ddocument.createElement('tr')%3BtrTot.id%3DTR_TOT_ID%3BtrTot.style.fontWeight%3D'bold'%3BtrTot.style.backgroundColor%3D'%23e8f5e9'%3Btbody.appendChild(trTot)%3B%7DtrTot.innerHTML%3D%5B'%3Ctd%20colspan%3D%225%22%20style%3D%22text-align%3Aright%3Bfont-weight%3Abold%22%3ETOTALI%3A%3C%2Ftd%3E'%2C'%3Ctd%20style%3D%22text-align%3Aright%3Bcolor%3A'%2BColoreSegno%5BtotImp%3E%3D0%5D%2B'%22%3E'%2BfmtN(totImp)%2B'%3C%2Ftd%3E'%2C'%3Ctd%20style%3D%22text-align%3Aright%3Bcolor%3A'%2BColoreSegno%5BtotIva%3E%3D0%5D%2B'%22%3E'%2BfmtN(totIva)%2B'%3C%2Ftd%3E'%2C'%3Ctd%3E%3C%2Ftd%3E'%2C'%3Ctd%20style%3D%22text-align%3Aright%3Bfont-weight%3Abold%3Bcolor%3A'%2BColoreSegno%5BtotTot%3E%3D0%5D%2B'%22%3E'%2BfmtN(totTot)%2B'%3C%2Ftd%3E'%2C'%3Ctd%20colspan%3D%223%22%3E%3C%2Ftd%3E'%5D.join('')%3B%7Dfunction%20analizzaNumeriMancanti(righe)%7BrimuoviEl('FEPlugin_NumMancanti')%3Bvar%20titolo%3Ddocument.querySelector('.no-margin-top.ng-binding%2Ch2.ng-binding')%3Bif(!titolo)return%3Bvar%20numPerSezionale%3D%7B%7D%3BArray.from(righe).forEach(function(riga)%7Bvar%20numTxt%3Driga.children%5B2%5D%3Friga.children%5B2%5D.innerText.trim()%3A''%3Bvar%20tipoDoc%3Driga.children%5B1%5D%3Friga.children%5B1%5D.innerText%3A''%3Bvar%20isNC%3DtipoDoc.indexOf('Nota%20di%20credito')%3E-1%3Bvar%20suffix%3DisNC%3F'(NC)'%3A''%3Bvar%20posAlfa%3DnumTxt.search(%2F%5Ba-zA-Z%5D%2F)%3Bvar%20sezionale%3D(posAlfa%3E-1)%3FnumTxt.substring(posAlfa).replace(%2F%5B0-9%5Cs%5D%2Fg%2C'').toUpperCase().trim()%3A'principale'%3Bsezionale%2B%3Dsuffix%3Bvar%20numPuro%3DparseInt(numTxt.replace(%2F%5B%5E0-9%5D%2Fg%2C''))%7C%7C0%3Bif(!numPerSezionale%5Bsezionale%5D)numPerSezionale%5Bsezionale%5D%3D%5B%5D%3BnumPerSezionale%5Bsezionale%5D.push(numPuro)%3B%7D)%3Bvar%20divMancanti%3Ddocument.createElement('div')%3BdivMancanti.id%3D'FEPlugin_NumMancanti'%3BdivMancanti.style.cssText%3D'padding%3A10px%200%3Bfont-size%3A14px%3B'%3BdivMancanti.innerHTML%3D'%3Cb%3ENumeri%20mancanti%3A%3C%2Fb%3E'%3Bvar%20ul%3Ddocument.createElement('ul')%3BObject.keys(numPerSezionale).forEach(function(sez)%7Bvar%20nums%3DnumPerSezionale%5Bsez%5D.filter(function(n)%7Breturn%20n%3E0%3B%7D)%3Bnums.sort(function(a%2Cb)%7Breturn%20a-b%3B%7D)%3Bvar%20mancanti%3D%5B%5D%2Ccont%3Dnums%5B0%5D%3Bfor(var%20i%3D1%3Bi%3Cnums.length%3Bi%2B%2B)%7Bcont%2B%2B%3Bwhile(cont%3Cnums%5Bi%5D)%7Bmancanti.push(cont)%3Bcont%2B%2B%3B%7D%7Dvar%20li%3Ddocument.createElement('li')%3Bif(mancanti.length%3D%3D%3D0)%7Bli.style.color%3D'green'%3Bli.innerHTML%3D'Sezionale%3Cb%3E'%2Bsez%2B'%3C%2Fb%3E%3AOK'%3B%7Delse%7Bli.style.color%3D'black'%3Bli.innerHTML%3D'Sezionale%3Cb%3E'%2Bsez%2B'%3C%2Fb%3E%3Amancano%20'%2B(mancanti.length%3E10%3F'da%20'%2Bmancanti%5B0%5D%2B'%20a%20'%2Bmancanti%5Bmancanti.length-1%5D%3Amancanti.join('%2C'))%3B%7Dul.appendChild(li)%3B%7D)%3BdivMancanti.appendChild(ul)%3Btitolo.parentNode.insertBefore(divMancanti%2Ctitolo.nextSibling)%3B%7Dfunction%20aggiungiFattureTransfrontaliere()%7Bvar%20Dal%3Ddocument.getElementById('dal')%3Bvar%20Al%3Ddocument.getElementById('al')%3Bif(!Dal)%7Balert('Funzione%20disponibile%20solo%20nella%20sezione%20Fatture%20emesse.')%3Breturn%3B%7DstorageSet('DataDal'%2CDal.value)%3BstorageSet('DataAl'%2CAl.value)%3Bvar%20linkEstere%3Ddocument.querySelector('a%5Bhref%3D%22%23%2Ftransfrontaliere%2Femesse%22%5D')%3Bif(linkEstere)linkEstere.click()%3Belse%7Balert('Link%20fatture%20transfrontaliere%20non%20trovato.')%3Breturn%3B%7DsetStatus('Navigazione%20a%20transfrontaliere...')%3BsetTimeout(acquisisciFattureTransfrontaliere%2C1500)%3B%7Dfunction%20acquisisciFattureTransfrontaliere()%7Bvar%20righe%3Ddocument.querySelectorAll('tr%5Bdata-ng-repeat*%3D%22vm.items%22%5D')%3Bif(righe.length%3D%3D%3D0)%7BsetTimeout(acquisisciFattureTransfrontaliere%2C500)%3Breturn%3B%7Dvar%20dati%3D%5B%5D%3Brighe.forEach(function(r)%7Bdati.push(%7Btipo%3Ar.children%5B1%5D%3Fr.children%5B1%5D.innerText%3A''%2Cnumero%3Ar.children%5B2%5D%3Fr.children%5B2%5D.innerText%3A''%2Cdata%3Ar.children%5B3%5D%3Fr.children%5B3%5D.innerText%3A''%2Cpaese%3Ar.children%5B4%5D%3Fr.children%5B4%5D.innerText%3A''%2Cimponibile%3Ar.children%5B5%5D%3Fr.children%5B5%5D.innerText%3A''%2Civa%3Ar.children%5B6%5D%3Fr.children%5B6%5D.innerText%3A''%7D)%3B%7D)%3BstorageSet('FattureTransfrontaliere'%2Cdati)%3Bvar%20linkEmesse%3Ddocument.querySelector('a%5Bhref%3D%22%23%2Ffatture%2Femesse%22%5D')%3Bif(linkEmesse)linkEmesse.click()%3BsetTimeout(integraTransfrontaliere%2C1500)%3B%7Dfunction%20integraTransfrontaliere()%7Bvar%20dati%3DstorageGet('FattureTransfrontaliere'%2C%5B%5D)%3Bvar%20tbody%3Ddocument.querySelector('table%20tbody')%3Bif(!tbody)%7BsetTimeout(integraTransfrontaliere%2C500)%3Breturn%3B%7Ddati.forEach(function(d%2Ci)%7Bvar%20tr%3Ddocument.createElement('tr')%3Btr.style.backgroundColor%3D'%23fff8e1'%3Btr.name%3D'FEPlugin_Transfrontaliera'%3Btr.innerHTML%3D%5B'%3Cth%20style%3D%22font-weight%3A400%22%3EFattura%20transfrontaliera%3C%2Fth%3E'%2C'%3Ctd%3E'%2Bd.tipo%2B'%3C%2Ftd%3E'%2C'%3Ctd%3E'%2Bd.numero%2B'%3C%2Ftd%3E'%2C'%3Ctd%3E'%2Bd.data%2B'%3C%2Ftd%3E'%2C'%3Ctd%3E'%2Bd.paese%2B'%3C%2Ftd%3E'%2C'%3Ctd%20style%3D%22text-align%3Aright%22%3E'%2Bd.imponibile%2B'%3C%2Ftd%3E'%2C'%3Ctd%20style%3D%22text-align%3Aright%22%3E'%2Bd.iva%2B'%3C%2Ftd%3E'%2C'%3Ctd%20colspan%3D%224%22%3E%3C%2Ftd%3E'%5D.join('')%3Btbody.appendChild(tr)%3B%7D)%3Bvar%20dal%3DstorageGet('DataDal'%2C'')%3Bvar%20al%3DstorageGet('DataAl'%2C'')%3Bvar%20Dal%3Ddocument.getElementById('dal')%3Bvar%20Al%3Ddocument.getElementById('al')%3Bif(Dal%26%26dal)%7BDal.value%3Ddal%3BDal.dispatchEvent(new%20Event('change'))%3B%7Dif(Al%26%26al)%7BAl.value%3Dal%3BAl.dispatchEvent(new%20Event('change'))%3B%7DsetStatus('%E2%9C%85%20Aggiunte%20'%2Bdati.length%2B'%20fatture%20transfrontaliere.')%3B%7Dfunction%20avviaAnalisiCorrispettivi()%7Bif(window.location.hash.indexOf('%2Fcorrispettivi%2F')%3D%3D%3D-1)%7Bif(!confirm('Non%20sei%20nella%20sezione%20Corrispettivi.%20Hash%20corrente%3A'%2Bwindow.location.hash%2B'%5CnContinuare%3F'))return%3B%7Dif(_inCorso)return%3BsetRunning(true)%3BsetProgress(0%2C'Raccolta%20lista%20corrispettivi...')%3BsetTimeout(function()%7BraccogliListaCorr(1%2CgetTotalPages()%2C%5B%5D%2Cfunction(voci)%7Bif(_stop)%7BsetRunning(false)%3Breturn%3B%7Dif(voci.length%3D%3D%3D0)%7BsetRunning(false)%3BsetStatus('%E2%9A%A0%20Nessun%20corrispettivo%20trovato.%20Controllare%20la%20sezione%20aperta.')%3Breturn%3B%7Dlog('Voci%20raccolte%3A'%2Bvoci.length%2B'%20%E2%80%94%20prima%3A'%2BJSON.stringify(voci%5B0%5D))%3BsetStatus('%E2%96%B6%20'%2Bvoci.length%2B'%20corrispettivi.%20Lettura%20dettagli...')%3BanalizzaDettagliCorr(voci%2C0%2C%7B%7D)%3B%7D)%3B%7D%2C300)%3B%7Dfunction%20raccogliListaCorr(pagina%2CtotPagine%2Cvoci%2Ccallback)%7Bif(_stop)%7Bcallback(voci)%3Breturn%3B%7Dvar%20righe%3Ddocument.querySelectorAll('tr%5Bdata-ng-repeat*%3D%22vm.items%22%5D')%3Brighe.forEach(function(r)%7Bvar%20linkEl%3Dr.querySelector('a.btn.btn-primary.btn-xs')%3Bif(!linkEl)return%3Bvar%20href%3DlinkEl.getAttribute('href')%7C%7C''%3Bif(href.indexOf('%2Fcorrispettivi%2Fdettaglio%2F')%3D%3D%3D-1)return%3Bvar%20matricola%3Dr.children%5B1%5D%3Fr.children%5B1%5D.innerText.trim()%3A''%3Bvar%20dataOra%3Dr.children%5B2%5D%3Fr.children%5B2%5D.innerText.trim()%3A''%3Bvar%20data%3DdataOra.substring(0%2C10)%3Bvar%20totaleLordo%3DconvN(r.children%5B5%5D%3Fr.children%5B5%5D.innerText%3A'0')%3Bvar%20idInvio%3Dr.children%5B0%5D%3Fr.children%5B0%5D.innerText.trim()%3A''%3Bif(!matricola%7C%7C!data%7C%7Cdata.length%3C10)return%3Bfor(var%20i%3D0%3Bi%3Cvoci.length%3Bi%2B%2B)%7Bif(voci%5Bi%5D.hash%3D%3D%3Dhref)return%3B%7Dvoci.push(%7Bhash%3Ahref%2Cmatricola%3Amatricola%2Cdata%3Adata%2CtotaleLordo%3AtotaleLordo%2CidInvio%3AidInvio%7D)%3B%7D)%3BsetProgress(pagina%2FtotPagine*15%2C'Lista%20pag.%20'%2Bpagina%2B'%2F'%2BtotPagine%2B'('%2Bvoci.length%2B'%20trovati)')%3Bif(pagina%3E%3DtotPagine)%7BsetPage(1).then(function()%7BsetTimeout(function()%7Bcallback(voci)%3B%7D%2C500)%3B%7D)%3B%7Delse%7BsetPage(pagina%2B1).then(function()%7BraccogliListaCorr(pagina%2B1%2CtotPagine%2Cvoci%2Ccallback)%3B%7D)%3B%7D%7Dfunction%20analizzaDettagliCorr(voci%2Cidx%2CdatiPerMatricola)%7Bif(_stop%7C%7Cidx%3E%3Dvoci.length)%7BsetRunning(false)%3Bif(!_stop)%7BsetProgress(97%2C'Generazione%20file%20Excel...')%3BsetTimeout(function()%7BgeneraExcelCorrispettivi(datiPerMatricola)%3B%7D%2C300)%3B%7Dreturn%3B%7Dvar%20voce%3Dvoci%5Bidx%5D%3BsetProgress(15%2B(idx%2Fvoci.length*82)%2C'Corrispettivo%20'%2B(idx%2B1)%2B'%2F'%2Bvoci.length%2B'%20%E2%80%94%20'%2Bvoce.matricola%2B'%20'%2Bvoce.data)%3Bwindow.location.hash%3Dvoce.hash%3Bnew%20Promise(function(res)%7BaspettaDettaglioCorr(res)%3B%7D).then(function(ok)%7Bif(!ok)%7Blog('Timeout%20corr%20%23'%2Bidx%2B'('%2Bvoce.hash%2B')%2Csalto.')%3BtornaAllaListaCorr(function()%7BanalizzaDettagliCorr(voci%2Cidx%2B1%2CdatiPerMatricola)%3B%7D)%3Breturn%3B%7Dtry%7Bvar%20dettIva%3DleggiDettaglioCorr()%3Bvar%20mat%3Dvoce.matricola%3Bif(!datiPerMatricola%5Bmat%5D)datiPerMatricola%5Bmat%5D%3D%5B%5D%3BdatiPerMatricola%5Bmat%5D.push(%7Bdata%3Avoce.data%2CidInvio%3Avoce.idInvio%7C%7C''%2CtotaleLordo%3Avoce.totaleLordo%2Caliquote%3AdettIva.aliquote%2Cresi%3AdettIva.resi%2Cannulli%3AdettIva.annulli%7D)%3Blog('Letto%3A'%2Bmat%2B'%20'%2Bvoce.data%2B'%20aliquote%3D'%2BJSON.stringify(Object.keys(dettIva.aliquote)))%3B%7Dcatch(e)%7Blog('Errore%20leggiDettaglioCorr%20%23'%2Bidx%2B'%3A'%2Be)%3B%7DsetTimeout(function()%7BtornaAllaListaCorr(function()%7BanalizzaDettagliCorr(voci%2Cidx%2B1%2CdatiPerMatricola)%3B%7D)%3B%7D%2C350)%3B%7D)%3B%7Dfunction%20leggiDettaglioCorr()%7Bvar%20result%3D%7Baliquote%3A%7B%7D%2Cresi%3A0%2Cannulli%3A0%7D%3Bvar%20tabIva%3Dnull%3Bvar%20tables%3Ddocument.querySelectorAll('table')%3Bfor(var%20t%3D0%3Bt%3Ctables.length%3Bt%2B%2B)%7Bvar%20ths%3Dtables%5Bt%5D.querySelectorAll('thead%20th')%3Bfor(var%20h%3D0%3Bh%3Cths.length%3Bh%2B%2B)%7Bif(ths%5Bh%5D.innerText.indexOf('Aliquota')%3E-1)%7BtabIva%3Dtables%5Bt%5D%3Bbreak%3B%7D%7Dif(tabIva)break%3B%7Dif(!tabIva)%7Blog('Tabella%20IVA%20non%20trovata')%3Breturn%20result%3B%7Dvar%20righe%3DtabIva.querySelectorAll('tbody%20tr.ng-scope')%3Bif(righe.length%3D%3D%3D0)%7Bvar%20tutte%3DtabIva.querySelectorAll('tbody%20tr')%3Brighe%3DArray.prototype.slice.call(tutte%2C0%2Ctutte.length-1)%3B%7DArray.prototype.forEach.call(righe%2Cfunction(r)%7Bvar%20c%3Dr.children%3Bif(!c%5B1%5D)return%3Bvar%20aliquota%3Dc%5B1%5D.innerText.trim()%3Bvar%20natura%3Dc%5B4%5D%3Fc%5B4%5D.innerText.trim()%3A''%3Bvar%20ventil%3Dc%5B5%5D%3Fc%5B5%5D.innerText.trim()%3A''%3Bvar%20impSpan%3Dc%5B2%5D%3Fc%5B2%5D.querySelector('span.ng-binding')%3Anull%3Bvar%20imp%3DimpSpan%3FconvN(impSpan.innerText)%3A(c%5B2%5D%3FconvN(c%5B2%5D.innerText)%3A0)%3Bvar%20iva%3Dc%5B3%5D%3FconvN(c%5B3%5D.innerText)%3A0%3Bvar%20resi%3Dc%5B8%5D%3FconvN(c%5B8%5D.innerText)%3A0%3Bvar%20annulli%3Dc%5B9%5D%3FconvN(c%5B9%5D.innerText)%3A0%3Bvar%20id%3Dventil%3F'Ventilazione%20IVA'%3A(parseFloat(aliquota)%3E0%3Faliquota.replace(%2F%5Cs%2Fg%2C'')%3A(natura%7C%7C'Esente%2FN.I.'))%3Bif(!result.aliquote%5Bid%5D)result.aliquote%5Bid%5D%3D%7Bimp%3A0%2Civa%3A0%7D%3Bresult.aliquote%5Bid%5D.imp%2B%3Dimp%3Bresult.aliquote%5Bid%5D.iva%2B%3Diva%3Bresult.resi%2B%3Dresi%3Bresult.annulli%2B%3Dannulli%3B%7D)%3Breturn%20result%3B%7Dfunction%20aspettaDettaglioCorr(resolve%2Cms)%7Bms%3Dms%7C%7C0%3Bif(ms%3E7000)%7Bresolve(false)%3Breturn%3B%7Dvar%20tables%3Ddocument.querySelectorAll('table')%3Bfor(var%20t%3D0%3Bt%3Ctables.length%3Bt%2B%2B)%7Bvar%20ths%3Dtables%5Bt%5D.querySelectorAll('thead%20th')%3Bfor(var%20h%3D0%3Bh%3Cths.length%3Bh%2B%2B)%7Bif(ths%5Bh%5D.innerText.indexOf('Aliquota')%3E-1)%7Bresolve(true)%3Breturn%3B%7D%7D%7DsetTimeout(function()%7BaspettaDettaglioCorr(resolve%2Cms%2B200)%3B%7D%2C200)%3B%7Dfunction%20tornaAllaListaCorr(callback)%7Bvar%20btn%3Ddocument.querySelector('%5Bdata-ng-click*%3D%22backtoLista%22%5D')%3Bif(btn)%7Bbtn.click()%3BsetTimeout(callback%2C600)%3Breturn%3B%7Dvar%20chevron%3Ddocument.querySelector('.fa-chevron-left')%3Bif(chevron%26%26chevron.parentNode)%7Bchevron.parentNode.click()%3BsetTimeout(callback%2C600)%3Breturn%3B%7Dhistory.back()%3BsetTimeout(callback%2C700)%3B%7Dfunction%20generaExcelCorrispettivi(datiPerMatricola)%7Bvar%20matricole%3DObject.keys(datiPerMatricola)%3Bif(matricole.length%3D%3D%3D0)%7BsetStatus('%E2%9A%A0%20Nessun%20dato%20raccolto.%20Riprovare.')%3Breturn%3B%7Dvar%20pivaEl%3Ddocument.getElementById('piva')%3Bvar%20piva%3DpivaEl%3F(pivaEl.value%7C%7C'').trim()%3A''%3Bfunction%20parseDataIt(s)%7Bvar%20p%3Ds%3Fs.split('%2F')%3A%5B%5D%3Breturn%20p.length%3D%3D%3D3%3Fnew%20Date(%2Bp%5B2%5D%2C%2Bp%5B1%5D-1%2C%2Bp%5B0%5D)%3Anew%20Date(0)%3B%7Dvar%20nFile%3D0%3Bmatricole.forEach(function(matricola)%7Bvar%20giorni%3DdatiPerMatricola%5Bmatricola%5D%3Bgiorni.sort(function(a%2Cb)%7Breturn%20parseDataIt(a.data)-parseDataIt(b.data)%3B%7D)%3Bvar%20aliquoteSet%3D%7B%7D%3Bgiorni.forEach(function(g)%7BObject.keys(g.aliquote).forEach(function(id)%7BaliquoteSet%5Bid%5D%3Dtrue%3B%7D)%3B%7D)%3Bvar%20aliquote%3DObject.keys(aliquoteSet)%3Bvar%20thAliquote%3D''%3Baliquote.forEach(function(id)%7BthAliquote%2B%3D'%3Cth%3EImponibile%20'%2Bid%2B'%3C%2Fth%3E%3Cth%3EIVA%20'%2Bid%2B'%3C%2Fth%3E'%3B%7D)%3Bvar%20intestazione%3D'%3Cth%3EID%20Invio%3C%2Fth%3E%3Cth%3EData%3C%2Fth%3E'%2BthAliquote%2B'%3Cth%3ETot.%20Imponibile%3C%2Fth%3E%3Cth%3ETot.%20IVA%3C%2Fth%3E'%2B'%3Cth%3EResi(memo)%3C%2Fth%3E%3Cth%3EAnnulli(memo)%3C%2Fth%3E'%2B'%3Cth%3ETotale%20Corrispettivi%3C%2Fth%3E'%3Bvar%20righeHtml%3D''%3Bvar%20totPerAliquota%3D%7B%7D%3Baliquote.forEach(function(id)%7BtotPerAliquota%5Bid%5D%3D%7Bimp%3A0%2Civa%3A0%7D%3B%7D)%3Bvar%20totImpGlobale%3D0%2CtotIvaGlobale%3D0%3Bvar%20totResiMemo%3D0%2CtotAnnulliMemo%3D0%3Bgiorni.forEach(function(g)%7Bvar%20tdAliquote%3D''%3Bvar%20totImpRiga%3D0%2CtotIvaRiga%3D0%3Baliquote.forEach(function(id)%7Bvar%20imp%3Dg.aliquote%5Bid%5D%3Fg.aliquote%5Bid%5D.imp%3A0%3Bvar%20iva%3Dg.aliquote%5Bid%5D%3Fg.aliquote%5Bid%5D.iva%3A0%3BtdAliquote%2B%3D'%3Ctd%20align%3D%22right%22%3E'%2B(g.aliquote%5Bid%5D%3FfmtN(imp)%3A'')%2B'%3C%2Ftd%3E'%3BtdAliquote%2B%3D'%3Ctd%20align%3D%22right%22%3E'%2B(g.aliquote%5Bid%5D%3FfmtN(iva)%3A'')%2B'%3C%2Ftd%3E'%3BtotImpRiga%2B%3Dimp%3BtotIvaRiga%2B%3Diva%3BtotPerAliquota%5Bid%5D.imp%2B%3Dimp%3BtotPerAliquota%5Bid%5D.iva%2B%3Diva%3B%7D)%3Bvar%20totaleGiorno%3DtotImpRiga%2BtotIvaRiga%3BtotImpGlobale%2B%3DtotImpRiga%3BtotIvaGlobale%2B%3DtotIvaRiga%3BtotResiMemo%2B%3Dg.resi%3BtotAnnulliMemo%2B%3Dg.annulli%3BrigheHtml%2B%3D'%3Ctr%3E'%2B'%3Ctd%20align%3D%22center%22%3E'%2B(g.idInvio%7C%7C'')%2B'%3C%2Ftd%3E'%2B'%3Ctd%20align%3D%22center%22%3E'%2Bg.data%2B'%3C%2Ftd%3E'%2BtdAliquote%2B'%3Ctd%20align%3D%22right%22%3E%3Cb%3E'%2BfmtN(totImpRiga)%2B'%3C%2Fb%3E%3C%2Ftd%3E'%2B'%3Ctd%20align%3D%22right%22%3E%3Cb%3E'%2BfmtN(totIvaRiga)%2B'%3C%2Fb%3E%3C%2Ftd%3E'%2B'%3Ctd%20align%3D%22right%22%20style%3D%22color%3A%23999%3Bfont-style%3Aitalic%22%3E'%2BfmtN(g.resi)%2B'%3C%2Ftd%3E'%2B'%3Ctd%20align%3D%22right%22%20style%3D%22color%3A%23999%3Bfont-style%3Aitalic%22%3E'%2BfmtN(g.annulli)%2B'%3C%2Ftd%3E'%2B'%3Ctd%20align%3D%22right%22%3E%3Cb%3E'%2BfmtN(totaleGiorno)%2B'%3C%2Fb%3E%3C%2Ftd%3E'%2B'%3C%2Ftr%3E'%3B%7D)%3Bvar%20tdTotAliquote%3D''%3Baliquote.forEach(function(id)%7BtdTotAliquote%2B%3D'%3Cth%20align%3D%22right%22%3E'%2BfmtN(totPerAliquota%5Bid%5D.imp)%2B'%3C%2Fth%3E'%2B'%3Cth%20align%3D%22right%22%3E'%2BfmtN(totPerAliquota%5Bid%5D.iva)%2B'%3C%2Fth%3E'%3B%7D)%3Bvar%20totaleGlobale%3DtotImpGlobale%2BtotIvaGlobale%3Bvar%20rigaTotali%3D'%3Ctr%20style%3D%22background%3A%23c8e6c9%3Bfont-weight%3Abold%22%3E'%2B'%3Cth%20colspan%3D%222%22%3ETOTALI%3C%2Fth%3E'%2BtdTotAliquote%2B'%3Cth%20align%3D%22right%22%3E'%2BfmtN(totImpGlobale)%2B'%3C%2Fth%3E'%2B'%3Cth%20align%3D%22right%22%3E'%2BfmtN(totIvaGlobale)%2B'%3C%2Fth%3E'%2B'%3Cth%20align%3D%22right%22%20style%3D%22color%3A%23999%22%3E'%2BfmtN(totResiMemo)%2B'%3C%2Fth%3E'%2B'%3Cth%20align%3D%22right%22%20style%3D%22color%3A%23999%22%3E'%2BfmtN(totAnnulliMemo)%2B'%3C%2Fth%3E'%2B'%3Cth%20align%3D%22right%22%3E'%2BfmtN(totaleGlobale)%2B'%3C%2Fth%3E'%2B'%3C%2Ftr%3E'%3Bvar%20nCols%3D2%2Baliquote.length*2%2B5%3Bvar%20xls%3D%22%3Cmeta%20http-equiv%3D'content-type'%20content%3D'text%2Fhtml%3Bcharset%3Dutf-8'%3E%22%2B%22%3Ctable%20border%3D'1'%20style%3D'border-collapse%3Acollapse'%3E%22%2B%22%3Ctr%3E%3Cth%20colspan%3D'%22%2BnCols%2B%22'%20align%3D'center'%20%22%2B%22style%3D'background%3A%231b3a2b%3Bcolor%3A%23a5d6a7%3Bfont-size%3A14px'%3E%22%2B%22Corrispettivi%26ndash%3B%22%2Bmatricola%2B%22%3C%2Fth%3E%3C%2Ftr%3E%22%2B%22%3Ctr%20style%3D'background%3A%23e8f5e9%3Bfont-weight%3Abold'%3E%22%2Bintestazione%2B%22%3C%2Ftr%3E%22%2BrigheHtml%2B%22%3Ctr%3E%3Ctd%20colspan%3D'%22%2BnCols%2B%22'%3E%3C%2Ftd%3E%3C%2Ftr%3E%22%2BrigaTotali%2B%22%3C%2Ftable%3E%22%3Bvar%20blob%3Dnew%20Blob(%5Bxls%5D%2C%7Btype%3A'application%2Fvnd.ms-excel%3Bcharset%3Dutf-8'%7D)%3Bvar%20url%3DURL.createObjectURL(blob)%3Bvar%20a%3Ddocument.createElement('a')%3Ba.href%3Durl%3Ba.download%3D(piva%3Fpiva%2B'_'%3A'')%2Bmatricola%2B'.xls'%3Ba.style.display%3D'none'%3Bdocument.body.appendChild(a)%3Ba.click()%3BnFile%2B%2B%3BsetTimeout(function()%7Ba.remove()%3BURL.revokeObjectURL(url)%3B%7D%2C3000)%3B%7D)%3BsetProgress(100%2C'%E2%9C%85%20Generati%20'%2BnFile%2B'%20file%20Excel('%2Bmatricole.join('%2C')%2B')')%3Bvar%20prow%3Ddocument.getElementById('FEPlugin_BottomRow')%3Bif(prow)setTimeout(function()%7Bprow.style.setProperty('display'%2C'none'%2C'important')%3B%7D%2C4000)%3B%7Dfunction%20creaSelezionaDate()%7Bif(document.getElementById('FEPlugin_DatePicker'))%7Bdocument.getElementById('FEPlugin_DatePicker').remove()%3Breturn%3B%7Dvar%20Dal%3Ddocument.getElementById('dal')%3Bvar%20Al%3Ddocument.getElementById('al')%3Bif(!Dal%7C%7C!Al)%7Balert('Campi%20data%20non%20trovati%20sulla%20pagina.')%3Breturn%3B%7Dvar%20pulsanteCerca%3Ddocument.querySelector('.btn.btn-primary.ng-binding')%3Bvar%20contenitore%3DDal.closest('.row%2C.col-md-6%2C.form-group')%7C%7CDal.parentNode%3Bvar%20oggi%3Dnew%20Date()%3Bvar%20annoCorrente%3Doggi.getFullYear()%3Bvar%20annoEl%3Ddocument.createElement('div')%3BannoEl.id%3D'FEPlugin_DatePicker'%3BannoEl.style.cssText%3D'background%3A%23e8f5e9%3Bborder%3A1px%20solid%20%232e7d32%3Bborder-radius%3A6px%3Bpadding%3A10px%3Bmargin-top%3A8px%3Bfont-size%3A12px%3B'%3Bvar%20anni%3D%5B%5D%3Bfor(var%20a%3DannoCorrente%3Ba%3E%3D2019%3Ba--)anni.push(a)%3BannoEl.innerHTML%3D%5B'%3Cb%20style%3D%22color%3A%231b3a2b%22%3EPlugin%20FE%3ASelettore%20date%3C%2Fb%3E%26nbsp%3B'%2C'Anno%3A%3Cinput%20type%3D%22number%22%20id%3D%22FEPlugin_Anno%22%20value%3D%22'%2BannoCorrente%2B'%22%20min%3D%222019%22%20max%3D%22'%2BannoCorrente%2B'%22%20style%3D%22width%3A60px%22%3E'%2C'%26nbsp%3B%3Cselect%20id%3D%22FEPlugin_PeriodSel%22%20style%3D%22font-size%3A12px%22%3E'%2C'%3Coption%20value%3D%22%22%3E--Seleziona%20periodo--%3C%2Foption%3E'%2C'%3Coption%20value%3D%22T1%22%3EI%20trimestre%3C%2Foption%3E'%2C'%3Coption%20value%3D%22T2%22%3EII%20trimestre%3C%2Foption%3E'%2C'%3Coption%20value%3D%22T3%22%3EIII%20trimestre%3C%2Foption%3E'%2C'%3Coption%20value%3D%22T4%22%3EIV%20trimestre%3C%2Foption%3E'%2C'%3Coption%20value%3D%22M1%22%3EGennaio%3C%2Foption%3E%3Coption%20value%3D%22M2%22%3EFebbraio%3C%2Foption%3E'%2C'%3Coption%20value%3D%22M3%22%3EMarzo%3C%2Foption%3E%3Coption%20value%3D%22M4%22%3EAprile%3C%2Foption%3E'%2C'%3Coption%20value%3D%22M5%22%3EMaggio%3C%2Foption%3E%3Coption%20value%3D%22M6%22%3EGiugno%3C%2Foption%3E'%2C'%3Coption%20value%3D%22M7%22%3ELuglio%3C%2Foption%3E%3Coption%20value%3D%22M8%22%3EAgosto%3C%2Foption%3E'%2C'%3Coption%20value%3D%22M9%22%3ESettembre%3C%2Foption%3E%3Coption%20value%3D%22M10%22%3EOttobre%3C%2Foption%3E'%2C'%3Coption%20value%3D%22M11%22%3ENovembre%3C%2Foption%3E%3Coption%20value%3D%22M12%22%3EDicembre%3C%2Foption%3E'%2C'%3Coption%20value%3D%22anno%22%3EAnno%20intero%3C%2Foption%3E'%2C'%3C%2Fselect%3E'%2C'%26nbsp%3B%3Cbutton%20id%3D%22FEPlugin_ApplicaDate%22%20style%3D%22font-size%3A11px%3Bpadding%3A3px%208px%3Bbackground%3A%232e7d32%3Bcolor%3Awhite%3Bborder%3Anone%3Bborder-radius%3A3px%3Bcursor%3Apointer%22%3EApplica%3C%2Fbutton%3E'%5D.join('')%3Bcontenitore.appendChild(annoEl)%3Bdocument.getElementById('FEPlugin_ApplicaDate').onclick%3Dfunction()%7Bvar%20anno%3DparseInt(document.getElementById('FEPlugin_Anno').value)%3Bvar%20sel%3Ddocument.getElementById('FEPlugin_PeriodSel').value%3Bif(!sel)return%3Bvar%20dalV%2CalV%3Bfunction%20ultimoGiornoMese(m)%7Breturn%20pad2(new%20Date(anno%2Cm%2C0).getDate())%2B'%2F'%2Bpad2(m)%2B'%2F'%2Banno%3B%7Dfunction%20capAOggi(dataStr)%7Bvar%20p%3DdataStr.split('%2F')%3Bvar%20d%3Dnew%20Date(%2Bp%5B2%5D%2C%2Bp%5B1%5D-1%2C%2Bp%5B0%5D)%3Bif(d%3Eoggi)%7Breturn%20pad2(oggi.getDate())%2B'%2F'%2Bpad2(oggi.getMonth()%2B1)%2B'%2F'%2Boggi.getFullYear()%3B%7Dreturn%20dataStr%3B%7Dif(sel%3D%3D%3D'anno')%7BdalV%3D'01%2F01%2F'%2Banno%3BalV%3D'31%2F12%2F'%2Banno%3B%7Delse%20if(sel.startsWith('T'))%7Bvar%20t%3DparseInt(sel%5B1%5D)%3Bvar%20mesi%3D%5B%5B1%2C3%5D%2C%5B4%2C6%5D%2C%5B7%2C9%5D%2C%5B10%2C12%5D%5D%5Bt-1%5D%3BdalV%3D'01%2F'%2Bpad2(mesi%5B0%5D)%2B'%2F'%2Banno%3BalV%3DultimoGiornoMese(mesi%5B1%5D)%3B%7Delse%7Bvar%20m%3DparseInt(sel.substring(1))%3BdalV%3D'01%2F'%2Bpad2(m)%2B'%2F'%2Banno%3BalV%3DultimoGiornoMese(m)%3B%7DalV%3DcapAOggi(alV)%3BDal.value%3DdalV%3BDal.dispatchEvent(new%20Event('change'))%3BsetTimeout(function()%7BAl.value%3DalV%3BAl.dispatchEvent(new%20Event('change'))%3Bif(pulsanteCerca)setTimeout(function()%7BpulsanteCerca.click()%3B%7D%2C250)%3B%7D%2C200)%3B%7D%3Bwindow._FEPlugin_keyHandler%3Dfunction(e)%7Bvar%20k%3De.keyCode%3Bif(document.activeElement%26%26document.activeElement.tagName%3D%3D%3D'INPUT')return%3Bvar%20sel%3Ddocument.getElementById('FEPlugin_PeriodSel')%3Bif(!sel)return%3Bvar%20mappa%3D%7B97%3A'T1'%2C98%3A'T2'%2C99%3A'T3'%2C100%3A'T4'%7D%3Bfor(var%20i%3D1%3Bi%3C%3D9%3Bi%2B%2B)mappa%5B48%2Bi%5D%3D'M'%2Bi%3Bmappa%5B48%5D%3D'M10'%3Bmappa%5B79%5D%3D'M11'%3Bmappa%5B80%5D%3D'M12'%3Bif(mappa%5Bk%5D)%7Bsel.value%3Dmappa%5Bk%5D%3Bdocument.getElementById('FEPlugin_ApplicaDate').click()%3B%7D%7D%3Bwindow.addEventListener('keydown'%2Cwindow._FEPlugin_keyHandler)%3BsetStatus('%F0%9F%93%85%20Selettore%20date%20attivo(tasti%3A1-4%20pad%3Dtrimestri%2C1-9%2C0%2CO%2CP%3Dmesi)')%3B%7DcreaPanel()%3BsetStatus('Pronto.%20Scegli%20un%5C'azione%20dal%20menu.')%3BsetTimeout(function()%7BtrySetAllOnOnePage()%3B%7D%2C500)%3Blog('Plugin%20FE%20v0.92%20beta%20avviato-'%2Bnew%20Date().toLocaleString())%3B%7D)()%3B">ğŸ“„ Plugin FE v0.92 beta</a><br>
        <span class="drag-hint">â†‘ Trascina nella barra dei preferiti</span>
      </div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-text">Alternativa: tasto destro sul link &rarr; <b>Aggiungi ai preferiti</b>.</div>
    </div>
    <div class="note">â„¹ï¸ I dati delle fatture giÃ  scaricate sono salvati nel <code>localStorage</code> del browser e persistono tra le sessioni.</div>
  </div>

  <div class="card">
    <h2>â–¶ Come usarlo</h2>
    <div class="step"><div class="step-num">1</div>
      <div class="step-text">Accedi su <a href="https://ivaservizi.agenziaentrate.gov.it" target="_blank">ivaservizi.agenziaentrate.gov.it</a></div>
    </div>
    <div class="step"><div class="step-num">2</div>
      <div class="step-text">Naviga nella sezione desiderata e seleziona il periodo</div>
    </div>
    <div class="step"><div class="step-num">3</div>
      <div class="step-text">Clicca il bookmarklet &mdash; appare la <b>barra verde fissa in cima alla pagina</b></div>
    </div>
    <div class="step"><div class="step-num">4</div>
      <div class="step-text">Scegli l'azione dalla barra. Una seconda riga con la barra di avanzamento appare durante le operazioni</div>
    </div>
  </div>

  <div class="card">
    <h2>ğŸ–¼ Anteprima barra</h2>
    <div class="bar-preview">
      <span>ğŸ“„ FE v0.92Î²</span>
      <button class="bar-btn" style="background:#2e7d32">â¬‡ Scarica fatture</button>
      <button class="bar-btn" style="background:#1565c0">ğŸ“Š Migliora tabella</button>
      <button class="bar-btn" style="background:#00695c">ğŸŒ Transfrontaliere</button>
      <button class="bar-btn" style="background:#e65100">ğŸ“ˆ Corrispettivi â†’ Excel</button>
      <button class="bar-btn" style="background:#37474f">ğŸ“… Date</button>
      <span style="margin-left:auto;color:#a5d6a7;font-size:18px;cursor:default">âœ•</span>
    </div>
    <p style="font-size:12px;color:#666;margin:4px 0 0">La barra usa <code>all:initial !important</code> su tutti gli elementi per resistere ai CSS di Bootstrap del portale.</p>
  </div>

  <div class="card">
    <h2>âœ¨ FunzionalitÃ </h2>
    <table>
      <tr><th>Pulsante</th><th>Sezione</th><th>Descrizione</th><th>Stato</th></tr>
      <tr>
        <td><b>â¬‡ Scarica fatture</b></td>
        <td>Fatture emesse / acquisti</td>
        <td>Scarica file XML e metadati di tutte le fatture, su tutte le pagine.</td>
        <td><span class="badge-green">âœ“ OK</span></td>
      </tr>
      <tr>
        <td><b>ğŸ“Š Migliora tabella</b></td>
        <td>Fatture emesse / acquisti</td>
        <td>Aggiunge colonna Totale, mostra nome cliente/fornitore, calcola totali. Clic su riga per escluderla.</td>
        <td><span class="badge-green">âœ“ OK</span></td>
      </tr>
      <tr>
        <td><b>ğŸŒ Transfrontaliere</b></td>
        <td>Fatture emesse</td>
        <td>Aggiunge le fatture transfrontaliere del periodo.</td>
        <td><span class="badge-green">âœ“ OK</span></td>
      </tr>
      <tr>
        <td><b>ğŸ“ˆ Corrispettivi â†’ Excel</b></td>
        <td>Corrispettivi telematici</td>
        <td>Genera un <code>.xls</code> per ogni matricola. Righe ordinate per data. Nome file: <code>piva_matricola.xls</code></td>
        <td><span class="badge-green">âœ“ OK</span></td>
      </tr>
      <tr>
        <td><b>ğŸ“… Date</b></td>
        <td>Ovunque</td>
        <td>Selettore trimestre/mese/anno con cap automatico a oggi. Scorciatoie: <span class="kbd">1â€“4</span> numpad = trimestri; <span class="kbd">1â€“9</span> <span class="kbd">0</span> <span class="kbd">O</span> <span class="kbd">P</span> = mesi.</td>
        <td><span class="badge-green">âœ“ OK</span></td>
      </tr>
    </table>
  </div>

  <div class="card">
    <h2>ğŸ“Š Struttura Excel corrispettivi (v0.92)</h2>
    <p style="font-size:13px">Nome file: <code>01647060811_2CITP003582.xls</code> &mdash; righe ordinate per data crescente.</p>
    <table style="font-size:11px">
      <tr>
        <th>ID Invio</th><th>Data</th>
        <th>Imponibile 10%</th><th>IVA 10%</th>
        <th>â€¦altre aliquoteâ€¦</th>
        <th>Tot. Imponibile</th><th>Tot. IVA</th>
        <th>Resi (memo)</th><th>Annulli (memo)</th>
        <th>Totale Corrispettivi</th>
      </tr>
      <tr>
        <td>12345</td><td align="center">01/02/2026</td>
        <td align="right">4.800,00</td><td align="right">480,00</td>
        <td></td>
        <td align="right"><b>4.800,00</b></td><td align="right"><b>480,00</b></td>
        <td align="right" style="color:#999">0,00</td><td align="right" style="color:#999">0,00</td>
        <td align="right"><b>5.280,00</b></td>
      </tr>
      <tr style="background:#e8f5e9;font-weight:bold">
        <td colspan="2">TOTALI</td>
        <td colspan="8" align="center">somme calcolate in JS</td>
      </tr>
    </table>
    <div class="note" style="margin-top:10px">
      â„¹ï¸ <b>Resi e Annulli</b> sono visualizzati in grigio come <i>memo</i> perchÃ© il portale li sottrae giÃ  a monte dall'imponibile. Il <b>Totale Corrispettivi</b> Ã¨ calcolato come <code>Imponibile + IVA</code> senza ulteriori deduzioni.
    </div>
  </div>

  <div class="card">
    <h2>ğŸ“‹ Changelog</h2>

    <div>
      <span class="cl-ver">v0.92 beta</span><span class="cl-date">23 febbraio 2026</span>
      <ul>
        <li><span class="tag-fix">FIX</span> Barra superiore: usato <code>all:initial !important</code> su tutti gli elementi per resistere ai CSS di Bootstrap del portale e rendersi correttamente in orizzontale.</li>
        <li><span class="tag-fix">FIX</span> Excel corrispettivi: Resi e Annulli ora sono colonne <i>memo</i> (visualizzazione grigia) e non vengono sottratti dal Totale Corrispettivi, poichÃ© il portale li deduce giÃ  a monte dall'imponibile.</li>
        <li><span class="tag-fix">FIX</span> Excel: Totale Corrispettivi = Imponibile + IVA (senza deduzioni resi/annulli).</li>
        <li><span class="tag-new">NEW</span> Excel: aggiunta colonna <b>ID Invio</b> (identificativo invio) come prima colonna del foglio.</li>
      </ul>
    </div>

    <div class="cl-entry">
      <span class="cl-ver">v0.91 beta</span><span class="cl-date">23 febbraio 2026</span>
      <ul>
        <li><span class="tag-new">NEW</span> Interfaccia: barra fissa in cima alla pagina al posto del pannello flottante.</li>
        <li><span class="tag-new">NEW</span> Excel: righe ordinate per data crescente.</li>
        <li><span class="tag-new">NEW</span> Excel: nome file <code>partitaiva_matricola.xls</code>.</li>
        <li><span class="tag-fix">FIX</span> Selettore date: data fine limitata automaticamente a oggi per periodi non ancora conclusi.</li>
      </ul>
    </div>

    <div class="cl-entry">
      <span class="cl-ver">v0.90 beta</span><span class="cl-date">23 febbraio 2026</span>
      <ul>
        <li><span class="tag-fix">FIX</span> Corrispettivi: deduplicazione per <code>href</code> (3 istanze Angular).</li>
        <li><span class="tag-fix">FIX</span> Excel: tutti i valori calcolati in JS, rimosso <code>rowspan</code>.</li>
        <li><span class="tag-fix">FIX</span> Migliora tabella: rilevamento sezione tramite URL hash.</li>
        <li><span class="tag-new">NEW</span> Prima release bookmarklet (Chrome, Firefox, Edge).</li>
        <li><span class="tag-new">NEW</span> Scaricamento fatture con paginazione automatica.</li>
        <li><span class="tag-new">NEW</span> Storage: <code>localStorage</code>.</li>
      </ul>
    </div>

  </div>

  <div style="text-align:center;color:#aaa;font-size:11px;margin-top:20px;padding-bottom:20px;">
    Plugin FE v0.92 beta &middot; ivaservizi.agenziaentrate.gov.it
  </div>

</div>
</body>
</html>
